<!DOCTYPE html><html lang=zh-CN data-default-color-scheme=auto><head><meta charset=UTF-8><link rel=apple-touch-icon sizes=76x76 href=/img/cat.ico><link rel=icon href=/img/cat.ico><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content=#2f4154><meta name=author content=煨酒小童><meta name=keywords content=简记><meta name=description content=最近遇到的一个问题：需要把老集群的部分服务迁移到新集群，要求新老集群里面的Pod可以互相通信调用。踩了几天的坑，磕磕绊绊总算是完成了。><meta property=og:type content=article><meta property=og:title content=Kubernetes跨集群通信><meta property=og:url content=https://lililib.github.io/posts/31816/index.html><meta property=og:site_name content=煨酒小童><meta property=og:description content=最近遇到的一个问题：需要把老集群的部分服务迁移到新集群，要求新老集群里面的Pod可以互相通信调用。踩了几天的坑，磕磕绊绊总算是完成了。><meta property=og:locale content=zh_CN><meta property=og:image content=https://lililib.github.io/posts/31816/image-20260122164204232.webp><meta property=og:image content=https://lililib.github.io/posts/31816/image-20260122163759231.webp><meta property=article:published_time content=2026-01-22T09:49:07.000Z><meta property=article:modified_time content=2026-02-11T08:51:19.422Z><meta property=article:author content=煨酒小童><meta property=article:tag content=Kubernetes><meta property=article:tag content=网络><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://lililib.github.io/posts/31816/image-20260122164204232.webp><meta name=referrer content=no-referrer-when-downgrade><title>Kubernetes跨集群通信 - 煨酒小童</title><link rel=stylesheet href=https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css><link rel=stylesheet href=https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css><link rel=stylesheet href=https://lib.baomitu.com/hint.css/2.7.0/hint.min.css><link rel=stylesheet href=https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css><link rel=stylesheet href=//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css><link rel=stylesheet href=//at.alicdn.com/t/font_1736178_lbnruvf0jn.css><link rel=stylesheet href=/css/main.css><link id=highlight-css rel=stylesheet href=/css/highlight.css><link id=highlight-css-dark rel=stylesheet href=/css/highlight-dark.css><link rel=stylesheet href=/css/custom-image-style.css><script id=fluid-configs>var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"lililib.github.io",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:80,cursorChar:"_",loop:!0,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"text"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/pendulum.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:{measurement_id:"G-EBGVN4YTH7"},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"XQLjYAtlel38u9sNetwJq3Ow-9Nh9j0Va",app_key:"pABl0aOxp8XJWMRafJWp3eX4",server_url:"https://xqljyatl.lc-cn-e1-shared.com",path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src=/js/utils.js></script><script src=/js/color-schema.js></script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-EBGVN4YTH7",function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","G-EBGVN4YTH7")})</script><meta name=generator content="Hexo 7.0.0"><link rel=alternate href=/atom.xml title=煨酒小童 type=application/atom+xml><link rel=alternate href=/rss2.xml title=煨酒小童 type=application/rss+xml></head><body><header><div class=header-inner style=height:70vh><nav id=navbar class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=/ ><strong>(￣m￣）</strong> </a><button id=navbar-toggler-btn class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation"><div class=animated-icon><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto text-center"><li class=nav-item><a class=nav-link href=/ target=_self><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class=nav-item><a class=nav-link href=/archives/ target=_self><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class=nav-item><a class=nav-link href=/categories/ target=_self><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class=nav-item><a class=nav-link href=/tags/ target=_self><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target=_self href=javascript:; role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><i class="iconfont icon-books"></i> <span>豆瓣</span></a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/books/index.html target=_self><span>读书</span> </a><a class=dropdown-item href=/movies/index.html target=_self><span>电影</span> </a><a class=dropdown-item href=/games/index.html target=_self><span>游戏</span> </a><a class=dropdown-item href=/songs/index.html target=_self><span>音乐</span></a></div></li><li class=nav-item><a class=nav-link href=/about/ target=_self><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class=nav-item id=search-btn><a class=nav-link target=_self href=javascript:; data-toggle=modal data-target=#modalSearch aria-label=Search><i class="iconfont icon-search"></i></a></li><li class=nav-item id=color-toggle-btn><a class=nav-link target=_self href=javascript:; aria-label="Color Toggle"><i class="iconfont icon-dark" id=color-toggle-icon></i></a></li></ul></div></div></nav><div id=banner class=banner parallax=true style="background:url(/img/sunset.webp) no-repeat center center;background-size:cover"><div class=full-bg-img><div class="mask flex-center" style=background-color:rgba(0,0,0,.3)><div class="banner-text text-center fade-in-up"><div class=h2><span id=subtitle data-typed-text=Kubernetes跨集群通信></span></div><div class=mt-3><span class=post-meta><i class="iconfont icon-date-fill" aria-hidden=true></i> <time datetime="2026-01-22 17:49" pubdate>2026年1月22日 下午</time></span></div><div class=mt-1><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.2k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 19 分钟 </span><span id=busuanzi_container_page_pv style=display:none><i class="iconfont icon-eye" aria-hidden=true></i> <span id=busuanzi_value_page_pv></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id=board-ctn><div id=board><article class="post-content mx-auto"><h1 id=seo-header>Kubernetes跨集群通信</h1><div class=markdown-body><p>最近遇到的一个问题：需要把老集群的部分服务迁移到新集群，要求新老集群里面的Pod可以互相通信调用。踩了几天的坑，磕磕绊绊总算是完成了。</p><span id=more></span><p>公司的Kubernetes环境存在新老两套集群：</p><ul><li><strong>老集群</strong>：自己购买云ECS服务器，手动搭建的Kubernetes集群，使用Calico网络插件</li><li><strong>新集群</strong>：直接使用云托管的Kubernetes服务，一键创建即用</li></ul><p>为了完成最小改动代码迁移任务,两个集群的服务都注册到同一个Nacos注册中心，需要实现跨集群的服务调用。</p><h3 id=2-1-老集群架构（自建K8s-Calico）><a href=#2-1-老集群架构（自建K8s-Calico） class=headerlink title="2.1 老集群架构（自建K8s + Calico）"></a>2.1 老集群架构（自建K8s + <a target=_blank rel=noopener href=https://www.cnblogs.com/yinzhengjie/p/18756862>Calico</a>）</h3><figure class="highlight crmsh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br></pre></td><td class=code><pre><code class="hljs crmsh">┌─────────────────────────────────────────────────────────────┐<br>│                   老集群（自建Kubernetes）                    │<br>├─────────────────────────────────────────────────────────────┤<br>│                                                              │<br>│  物理层：云ECS实例                                        │<br>│  ┌────────────────────────────────────────────────────┐    │<br>│  │ <span class=hljs-keyword>Node</span><span class=hljs-title>网络：10</span>.<span class=hljs-number>0.0</span>.<span class=hljs-number>0</span>/<span class=hljs-number>22</span>（VPC默认子网）                │    │<br>│  │                                                      │    │<br>│  │  <span class=hljs-keyword>Node</span><span class=hljs-title>列表：                                          │    │</span><br><span class=hljs-title>│  │  • 10</span>.<span class=hljs-number>0.0</span>.<span class=hljs-number>3</span>  (master01)                            │    │<br>│  │  • <span class=hljs-number>10.0</span>.<span class=hljs-number>0.19</span> (web02/docker-mgr)                    │    │<br>│  │  • <span class=hljs-number>10.0</span>.<span class=hljs-number>0.22</span> (web服务器<span class=hljs-number>03</span>)                         │    │<br>│  │  • 其他节点...                                      │    │<br>│  └────────────────────────────────────────────────────┘    │<br>│                           ↓                                  │<br>│  Overlay层：Calico IPIP网络                                 │<br>│  ┌────────────────────────────────────────────────────┐    │<br>│  │ Pod网络：<span class=hljs-number>172.26</span>.<span class=hljs-number>0.0</span>/<span class=hljs-number>16</span>（虚拟网络）                  │    │<br>│  │                                                      │    │<br>│  │  特点：                                              │    │<br>│  │  • 使用IPIP隧道（tunl0）进行跨节点通信             │    │<br>│  │  • 每个<span class=hljs-keyword>Node</span><span class=hljs-title>分配一个/26</span>子网（<span class=hljs-number>64</span>个IP）               │    │<br>│  │  • Pod IP对VPC不可见，只在集群内部路由              │    │<br>│  │                                                      │    │<br>│  │  示例Pod：                                           │    │<br>│  │  • <span class=hljs-number>172.26</span>.<span class=hljs-number>139.114</span>:<span class=hljs-number>9400</span> → 注册到Nacos               │    │<br>│  │  • <span class=hljs-number>172.26</span>.<span class=hljs-number>95.0</span>/<span class=hljs-number>26</span> → 分配给<span class=hljs-keyword>Node</span> <span class=hljs-title>10</span>.<span class=hljs-number>0.0</span>.<span class=hljs-number>19</span>          │    │<br>│  │  • <span class=hljs-number>172.26</span>.<span class=hljs-number>241.64</span>/<span class=hljs-number>26</span> → 分配给<span class=hljs-keyword>Node</span> <span class=hljs-title>10</span>.<span class=hljs-number>0.0</span>.<span class=hljs-number>3</span>         │    │<br>│  └────────────────────────────────────────────────────┘    │<br>│                                                              │<br>└─────────────────────────────────────────────────────────────┘<br></code></pre></td></tr></table></figure><p><strong>关键点：</strong></p><ul><li>Pod IP（172.26.x.x）是Overlay网络地址，不在VPC路由表中</li><li>Pod之间通过IPIP隧道通信</li><li>服务注册到Nacos时使用Pod IP</li></ul><h3 id=2-2-新集群架构（云托管K8s）><a href=#2-2-新集群架构（云托管K8s） class=headerlink title="2.2 新集群架构（云托管K8s）"></a>2.2 新集群架构（云托管K8s）</h3><p>云托管K8s在创建时会自动创建三个子网：</p><figure class="highlight crmsh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br></pre></td><td class=code><pre><code class="hljs crmsh">┌─────────────────────────────────────────────────────────────┐<br>│                新集群（云托管K8s）                  │<br>├─────────────────────────────────────────────────────────────┤<br>│                                                              │<br>│  自动创建的子网架构：                                         │<br>│                                                              │<br>│  ┌────────────────────────────────────────────────────┐    │<br>│  │ <span class=hljs-number>1</span>. <span class=hljs-keyword>Node</span><span class=hljs-title>子网：10</span>.<span class=hljs-number>0.40</span>.<span class=hljs-number>0</span>/<span class=hljs-number>22</span>                          │    │<br>│  │    路由表：k8s-axxxxxxxb-<span class=hljs-keyword>node</span><span class=hljs-title>-rt-0</span>                │    │<br>│  │    用途：K8s节点网络                                │    │<br>│  │    <span class=hljs-keyword>Node</span><span class=hljs-title>示例：10</span>.<span class=hljs-number>0.40</span>.<span class=hljs-number>15</span>                            │    │<br>│  └────────────────────────────────────────────────────┘    │<br>│                           ↓                                  │<br>│  ┌────────────────────────────────────────────────────┐    │<br>│  │ <span class=hljs-number>2</span>. Pod子网：<span class=hljs-number>10.0</span>.<span class=hljs-number>32.0</span>/<span class=hljs-number>21</span>（重点）                    │    │<br>│  │    路由表：k8s-axxxxxxxb-pod-rt-<span class=hljs-number>0</span>                 │    │<br>│  │    特点：                                            │    │<br>│  │    • Pod IP直接从VPC分配                           │    │<br>│  │    • 对VPC可见，可直接路由                         │    │<br>│  │    • 使用VPC-CNI插件                               │    │<br>│  │                                                      │    │<br>│  │    示例Pod：                                         │    │<br>│  │    • <span class=hljs-number>10.0</span>.<span class=hljs-number>32.21</span>:<span class=hljs-number>9400</span> → 注册到Nacos                │    │<br>│  └────────────────────────────────────────────────────┘    │<br>│                           ↓                                  │<br>│  ┌────────────────────────────────────────────────────┐    │<br>│  │ <span class=hljs-number>3</span>. NAT子网：<span class=hljs-number>10.0</span>.<span class=hljs-number>44.0</span>/<span class=hljs-number>23</span>                           │    │<br>│  │    路由表：k8s-axxxxxxxb-nat-rt-<span class=hljs-number>0</span>                │    │<br>│  │    用途：Pod访问公网的出口                          │    │<br>│  └────────────────────────────────────────────────────┘    │<br>│                                                              │<br>└─────────────────────────────────────────────────────────────┘<br></code></pre></td></tr></table></figure><p><strong>关键点：</strong></p><ul><li>Pod IP（10.0.32.x）是VPC内的真实IP</li><li>无需Overlay网络，性能更好</li></ul><h2 id=三、问题分析><a href=#三、问题分析 class=headerlink title=三、问题分析></a>三、问题分析</h2><h3 id=3-1-初始状态><a href=#3-1-初始状态 class=headerlink title="3.1 初始状态"></a>3.1 初始状态</h3><p>当服务部署到两个集群后，Nacos服务列表呈现如下状态：</p><p><img src=/posts/31816/image-20260122164204232.webp alt=image-20260122164204232></p><h3 id=3-2-通信测试结果><a href=#3-2-通信测试结果 class=headerlink title="3.2 通信测试结果"></a>3.2 通信测试结果</h3><table><thead><tr><th>通信方向</th><th>结果</th><th>说明</th></tr></thead><tbody><tr><td>新集群Node → 老集群Node</td><td>通</td><td>都在VPC内，可直接通信</td></tr><tr><td>老集群Node → 新集群Node</td><td>通</td><td>都在VPC内，可直接通信</td></tr><tr><td>老集群Pod → 新集群Pod</td><td>通</td><td>10.0.32.x在VPC路由表中可识别</td></tr><tr><td><strong>新集群Pod → 老集群Pod</strong></td><td><strong>不通</strong></td><td><strong>172.26.x不在VPC路由表中</strong></td></tr></tbody></table><h3 id=3-3-问题根源分析><a href=#3-3-问题根源分析 class=headerlink title="3.3 问题根源分析"></a>3.3 问题根源分析</h3><h4 id=为什么老集群Pod可以访问新集群Pod？><a href=#为什么老集群Pod可以访问新集群Pod？ class=headerlink title=为什么老集群Pod可以访问新集群Pod？></a>为什么老集群Pod可以访问新集群Pod？</h4><figure class="highlight accesslog"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre></td><td class=code><pre><code class="hljs accesslog">老集群Pod (<span class=hljs-number>172</span>.<span class=hljs-number>26</span>.<span class=hljs-number>139</span>.<span class=hljs-number>114</span>) 发起请求<br>     ↓<br>目标地址：<span class=hljs-number>10</span>.<span class=hljs-number>0</span>.<span class=hljs-number>32</span>.<span class=hljs-number>21</span><br>     ↓<br>老集群Node查询本地路由表<br>     ↓<br><span class=hljs-number>10.0.32.21</span> 不在本地，走默认路由到 VPC 网关<br>     ↓<br>VPC 识别 <span class=hljs-number>10</span>.<span class=hljs-number>0</span>.<span class=hljs-number>32</span>.<span class=hljs-number>0</span>/<span class=hljs-number>21</span> 是合法子网（Pod子网）<br>     ↓<br>路由到新集群Pod子网<br>     ↓<br>成功到达目标Pod<br></code></pre></td></tr></table></figure><h4 id=为什么新集群Pod无法访问老集群Pod？><a href=#为什么新集群Pod无法访问老集群Pod？ class=headerlink title=为什么新集群Pod无法访问老集群Pod？></a>为什么新集群Pod无法访问老集群Pod？</h4><figure class="highlight dns"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><code class="hljs dns">新集群Pod (<span class=hljs-number>10.0.32.21</span>) 发起请求<br>     ↓<br>目标地址：<span class=hljs-number>172.26.139.114</span><br>     ↓<br>查询Pod子网路由表 (k8s-axxxxxxxb-pod-rt-<span class=hljs-number>0</span>)<br>     ↓<br>路由表内容：<br>  - local → local（VPC内部流量）<br>  - <span class=hljs-number>0.0.0.0</span>/<span class=hljs-number>0</span> → NAT网关（默认路由）<br>  - 没有 <span class=hljs-number>172.26.0.0</span>/<span class=hljs-number>16</span> 的路由！<br>     ↓<br>匹配默认路由，流量发送到 NAT 网关<br>     ↓<br>NAT网关用于公网访问，无法到达集群内部地址<br></code></pre></td></tr></table></figure><h2 id=四、解决方案><a href=#四、解决方案 class=headerlink title=四、解决方案></a>四、解决方案</h2><h3 id=4-1-方案设计思路><a href=#4-1-方案设计思路 class=headerlink title="4.1 方案设计思路"></a>4.1 方案设计思路</h3><p>核心思路：<strong>让新集群知道如何到达老集群的Pod网络（172.26.0.0&#x2F;16）</strong></p><p>需要解决两个问题：</p><ol><li><strong>路由问题</strong>：告诉新集群Pod子网，172.26.0.0&#x2F;16的流量该发到哪里</li><li><strong>信任问题</strong>：让老集群的Calico接受来自新集群的请求</li></ol><h3 id=4-2-步骤一：配置Pod子网路由表><a href=#4-2-步骤一：配置Pod子网路由表 class=headerlink title="4.2 步骤一：配置Pod子网路由表"></a>4.2 步骤一：配置Pod子网路由表</h3><p>在云控制台操作：</p><ol><li>进入 VPC → 路由表</li><li>找到 <code>k8s-axxxxxxxb-pod-rt-0</code></li><li>添加路由策略：</li></ol><figure class="highlight dns"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><code class="hljs dns">目的端：<span class=hljs-number>172.26.0.0</span>/<span class=hljs-number>16</span><br>下一跳类型：云主机<br>下一跳：i-bddddddd5 (web服务器<span class=hljs-number>02</span> / <span class=hljs-number>10.0.0.19</span>)<br>路由类型：静态<br>备注：新集群pod通讯老集群pod<br></code></pre></td></tr></table></figure><p>配置后的路由表：</p><figure class="highlight accesslog"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><code class="hljs accesslog">local          → local                     # VPC内部流量<br><span class=hljs-number>0.0.0.0</span>/<span class=hljs-number>0</span>      → NAT网关                   # 公网流量<br><span class=hljs-number>172.26.0.0</span>/<span class=hljs-number>16</span>  → <span class=hljs-number>10</span>.<span class=hljs-number>0</span>.<span class=hljs-number>0</span>.<span class=hljs-number>19</span>（新增）        # 老集群Pod流量<br></code></pre></td></tr></table></figure><h3 id=4-3-步骤二：配置中转节点NAT规则><a href=#4-3-步骤二：配置中转节点NAT规则 class=headerlink title="4.3 步骤二：配置中转节点NAT规则"></a>4.3 步骤二：配置中转节点NAT规则</h3><p>为什么需要NAT？因为Calico会验证源IP，只信任本集群Node的IP。需要将新集群的请求伪装成老集群Node发出的。</p><p>在 10.0.0.19 节点上执行：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-comment># 1. 开启IP转发</span><br><span class=hljs-built_in>echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward<br><span class=hljs-built_in>echo</span> <span class=hljs-string>&quot;net.ipv4.ip_forward = 1&quot;</span> &gt;&gt; /etc/sysctl.conf<br>sysctl -p<br><br><span class=hljs-comment># 2. 添加NAT规则</span><br>iptables -t nat -A POSTROUTING -s 10.0.0.0/8 -d 172.26.0.0/16 -j MASQUERADE<br><br><span class=hljs-comment># 3. 创建systemd服务（确保重启后规则仍然生效）</span><br><span class=hljs-built_in>cat</span> &gt; /etc/systemd/system/custom-nat.service &lt;&lt; <span class=hljs-string>&#x27;EOF&#x27;</span><br>[Unit]<br>Description=Custom NAT Rules <span class=hljs-keyword>for</span> Cross-Cluster Communication<br>After=network.target calico-node.service<br>Before=kubelet.service<br><br>[Service]<br>Type=oneshot<br>ExecStart=/usr/sbin/iptables -t nat -A POSTROUTING -s 10.0.0.0/8 -d 172.26.0.0/16 -j MASQUERADE<br>RemainAfterExit=<span class=hljs-built_in>yes</span><br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br><br><span class=hljs-comment># 4. 启用服务</span><br>systemctl daemon-reload<br>systemctl <span class=hljs-built_in>enable</span> custom-nat.service<br>systemctl start custom-nat.service<br></code></pre></td></tr></table></figure><h2 id=五、流量路径详解><a href=#五、流量路径详解 class=headerlink title=五、流量路径详解></a>五、流量路径详解</h2><h3 id=5-1-配置后的完整通信流程><a href=#5-1-配置后的完整通信流程 class=headerlink title="5.1 配置后的完整通信流程"></a>5.1 配置后的完整通信流程</h3><h4 id=去程路径（新集群Pod-→-老集群Pod）><a href=#去程路径（新集群Pod-→-老集群Pod） class=headerlink title="去程路径（新集群Pod → 老集群Pod）"></a>去程路径（新集群Pod → 老集群Pod）</h4><figure class="highlight dns"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br></pre></td><td class=code><pre><code class="hljs dns">┌─────────────────────────────────────────────────────────────┐<br>│              新集群Pod → 老集群Pod 请求流程                   │<br>├─────────────────────────────────────────────────────────────┤<br>│                                                              │<br>│  <span class=hljs-number>1</span>. 新集群Pod发起请求                                         │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ Pod: <span class=hljs-number>10.0.32.21</span>                                │        │<br>│  │ 目标: <span class=hljs-number>172.26.139.114</span>:<span class=hljs-number>9400</span>                      │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>2</span>. 查询Pod子网路由表                                         │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ 匹配路由规则:                                    │        │<br>│  │ <span class=hljs-number>172.26.0.0</span>/<span class=hljs-number>16</span> → <span class=hljs-number>10.0.0.19</span>                     │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>3</span>. VPC路由到中转节点 (<span class=hljs-number>10.0.0.19</span>)                            │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ 数据包到达<span class=hljs-number>10.0.0.19</span>的eth0网卡                   │        │<br>│  │ 源IP: <span class=hljs-number>10.0.32.21</span>                               │        │<br>│  │ 目标IP: <span class=hljs-number>172.26.139.114</span>                         │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>4</span>. NAT地址伪装（关键步骤）                                   │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ iptables规则匹配并执行MASQUERADE                │        │<br>│  │ 源IP: <span class=hljs-number>10.0.32.21</span> → <span class=hljs-number>10.0.0.19</span>（伪装）          │        │<br>│  │ 目标IP: <span class=hljs-number>172.26.139.114</span>（不变）                 │        │<br>│  │ NAT表记录连接信息用于回程                       │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>5</span>. Calico路由转发                                           │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ <span class=hljs-number>10.0.0.19</span>查询本地Calico路由表                   │        │<br>│  │ <span class=hljs-number>172.26.139.64</span>/<span class=hljs-number>26</span> → <span class=hljs-number>10.0.0.36</span> via tunl0        │        │<br>│  │ 通过IPIP隧道转发                                │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>6</span>. IPIP隧道封装传输                                         │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ 外层: <span class=hljs-number>10.0.0.19</span> → <span class=hljs-number>10.0.0.36</span>                   │        │<br>│  │ 内层: <span class=hljs-number>10.0.0.19</span> → <span class=hljs-number>172.26.139.114</span>:<span class=hljs-number>9400</span>         │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>7</span>. 到达目标Pod并处理请求                                     │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ Pod: <span class=hljs-number>172.26.139.114</span>                            │        │<br>│  │ 看到的源IP: <span class=hljs-number>10.0.0.19</span>（老集群Node IP）         │        │<br>│  │ 处理业务请求，准备返回响应                       │        │<br>│  └────────────────────────────────────────────────┘        │<br>│                                                              │<br>└─────────────────────────────────────────────────────────────┘<br></code></pre></td></tr></table></figure><h4 id=回程路径（老集群Pod-→-新集群Pod-响应）><a href=#回程路径（老集群Pod-→-新集群Pod-响应） class=headerlink title="回程路径（老集群Pod → 新集群Pod 响应）"></a>回程路径（老集群Pod → 新集群Pod 响应）</h4><figure class="highlight dns"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br></pre></td><td class=code><pre><code class="hljs dns">┌─────────────────────────────────────────────────────────────┐<br>│              老集群Pod → 新集群Pod 响应流程                   │<br>├─────────────────────────────────────────────────────────────┤<br>│                                                              │<br>│  <span class=hljs-number>8</span>. 老集群Pod发送响应                                         │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ Pod: <span class=hljs-number>172.26.139.114</span>                            │        │<br>│  │ 响应目标: <span class=hljs-number>10.0.0.19</span>（看到的源IP）               │        │<br>│  │ 实际最终目标: <span class=hljs-number>10.0.32.21</span>（NAT会处理）           │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>9</span>. 通过Calico路由返回                                       │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ <span class=hljs-number>172.26.139.114</span> → <span class=hljs-number>10.0.0.36</span>（本地Node）        │        │<br>│  │ <span class=hljs-number>10.0.0.36</span> 查询路由：                            │        │<br>│  │ 目标<span class=hljs-number>10.0.0.19</span>是本集群Node，直接路由             │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>10</span>. IPIP隧道封装返回                                        │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ 外层: <span class=hljs-number>10.0.0.36</span> → <span class=hljs-number>10.0.0.19</span>                   │        │<br>│  │ 内层: <span class=hljs-number>172.26.139.114</span> → <span class=hljs-number>10.0.0.19</span>               │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>11</span>. 中转节点NAT反向转换（关键步骤）                          │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ <span class=hljs-number>10.0.0.19</span>收到响应包                             │        │<br>│  │ 查询NAT连接跟踪表                               │        │<br>│  │ 找到原始连接：<span class=hljs-number>10.0.32.21</span> ↔ <span class=hljs-number>10.0.0.19</span>          │        │<br>│  │ 执行反向NAT：                                   │        │<br>│  │   源IP: <span class=hljs-number>172.26.139.114</span>（保持不变）             │        │<br>│  │   目标IP: <span class=hljs-number>10.0.0.19</span> → <span class=hljs-number>10.0.32.21</span>（还原）      │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>12</span>. VPC路由转发回新集群                                     │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ <span class=hljs-number>10.0.0.19</span>查询路由表                             │        │<br>│  │ 目标<span class=hljs-number>10.0.32.21</span>属于新集群Pod子网                 │        │<br>│  │ 通过VPC路由转发                                 │        │<br>│  └──────────────────┬─────────────────────────────┘        │<br>│                      ↓                                       │<br>│  <span class=hljs-number>13</span>. 响应到达新集群Pod                                       │<br>│  ┌────────────────────────────────────────────────┐        │<br>│  │ Pod: <span class=hljs-number>10.0.32.21</span>                                │        │<br>│  │ 收到响应：源IP显示为<span class=hljs-number>172.26.139.114</span>              │        │<br>│  │ 完成一次完整的跨集群通信                         │        │<br>│  └────────────────────────────────────────────────┘        │<br>│                                                              │<br>└─────────────────────────────────────────────────────────────┘<br></code></pre></td></tr></table></figure><h4 id=连接跟踪机制说明><a href=#连接跟踪机制说明 class=headerlink title=连接跟踪机制说明></a>连接跟踪机制说明</h4><figure class="highlight dns"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre></td><td class=code><pre><code class="hljs dns">NAT连接跟踪表（conntrack）工作原理：<br><br>初始请求建立连接：<br>┌──────────────────────────────────────┐<br>│ 原始连接：                            │<br>│   <span class=hljs-number>10.0.32.21</span>:<span class=hljs-number>45678</span> → <span class=hljs-number>172.26.139.114</span>:<span class=hljs-number>9400</span> │<br>│                                       │<br>│ NAT后连接：                           │<br>│   <span class=hljs-number>10.0.0.19</span>:<span class=hljs-number>52341</span> → <span class=hljs-number>172.26.139.114</span>:<span class=hljs-number>9400</span>  │<br>│                                       │<br>└──────────────────────────────────────┘<br><br>响应包自动反向NAT：<br>┌──────────────────────────────────────┐<br>│ 收到响应：                            │<br>│   <span class=hljs-number>172.26.139.114</span>:<span class=hljs-number>9400</span> → <span class=hljs-number>10.0.0.19</span>:<span class=hljs-number>52341</span>  │<br>│                                       │<br>│ 查表反向转换：                         │<br>│   <span class=hljs-number>172.26.139.114</span>:<span class=hljs-number>9400</span> → <span class=hljs-number>10.0.32.21</span>:<span class=hljs-number>45678</span> │<br>│                                       │<br>│ 转发到原始请求方                       │<br>└──────────────────────────────────────┘<br></code></pre></td></tr></table></figure><h3 id=5-2-关键技术点解析><a href=#5-2-关键技术点解析 class=headerlink title="5.2 关键技术点解析"></a>5.2 关键技术点解析</h3><h4 id=NAT规则详解><a href=#NAT规则详解 class=headerlink title=NAT规则详解></a>NAT规则详解</h4><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">iptables -t nat -A POSTROUTING -s 10.0.0.0/8 -d 172.26.0.0/16 -j MASQUERADE<br></code></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>-t nat</code>：操作NAT表</li><li><code>-A POSTROUTING</code>：在POSTROUTING链添加规则（数据包离开前的最后处理）</li><li><code>-s 10.0.0.0/8</code>：源地址匹配（包含新集群的10.0.32.x）</li><li><code>-d 172.26.0.0/16</code>：目标地址匹配（老集群Pod网络）</li><li><code>-j MASQUERADE</code>：动态源地址伪装（自动使用出口网卡IP）</li></ul><h4 id=为什么选择10-0-0-19作为中转节点？><a href=#为什么选择10-0-0-19作为中转节点？ class=headerlink title=为什么选择10.0.0.19作为中转节点？></a>为什么选择10.0.0.19作为中转节点？</h4><ol><li><strong>稳定性</strong>：该节点是老集群的一部分，Calico路由完整</li><li><strong>信任关系</strong>：作为老集群Node，天然被Calico信任</li><li><strong>网络位置</strong>：在VPC内，新集群可以直接访问</li></ol><h2 id=七、方案优缺点><a href=#七、方案优缺点 class=headerlink title=七、方案优缺点></a>七、方案优缺点</h2><h3 id=优点><a href=#优点 class=headerlink title=优点></a>优点</h3><ol><li><strong>最小化改动</strong>：不需要修改应用代码，对业务透明</li><li><strong>配置简单</strong>：只需配置路由表和NAT规则</li></ol><h3 id=缺点><a href=#缺点 class=headerlink title=缺点></a>缺点</h3><ol><li><strong>单点依赖</strong>：依赖中转节点，存在单点故障风险</li><li><strong>扩展性</strong>：流量都经过中转节点，可能成为瓶颈</li></ol><h3 id=改进建议><a href=#改进建议 class=headerlink title=改进建议></a>改进建议</h3><ol><li><p>配置多个中转节点,这个需要子网路由表那边配置相同目的端,不同的下一跳云主机</p><p><img src=/posts/31816/image-20260122163759231.webp alt=image-20260122163759231></p></li></ol></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class=category-chains><span class=category-chain><a href=/categories/%E6%8A%80%E6%9C%AF/ class=category-chain-item>技术</a></span></span></div><div class=post-meta><i class="iconfont icon-tags"></i> <a href=/tags/Kubernetes/ class=print-no-link>#Kubernetes</a> <a href=/tags/%E7%BD%91%E7%BB%9C/ class=print-no-link>#网络</a></div></div><div class="license-box my-3"><div class=license-title><div>Kubernetes跨集群通信</div><div>https://lililib.github.io/posts/31816/</div></div><div class=license-meta><div class=license-meta-item><div>作者</div><div>煨酒小童</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2026年1月22日</div></div><div class=license-meta-item><div>许可协议</div><div><a class=print-no-link target=_blank href=https://creativecommons.org/licenses/by/4.0/ ><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href=/posts/50827/ title=从逆向ChatExcel到构建多Agent协作系统><i class="iconfont icon-arrowleft"></i> <span class=hidden-mobile>从逆向ChatExcel到构建多Agent协作系统</span> <span class=visible-mobile>上一篇</span></a></article><article class="post-next col-6"><a href=/posts/20328/ title=2个月跑步计划2><span class=hidden-mobile>2个月跑步计划2</span> <span class=visible-mobile>下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id=comments><div id=giscus class=giscus></div><script type=text/javascript>Fluid.utils.loadComments("#giscus",function(){var t,e={repo:"lililib/lililib.github.io","repo-id":"MDEwOlJlcG9zaXRvcnkzMTQ3MTgxNzc=",category:"Announcements","category-id":"DIC_kwDOEsI34c4CusH7","theme-light":"light","theme-dark":"dark",mapping:"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top",lang:"zh-CN"},i={};for(t in e)t.startsWith("theme-")||(i[t.startsWith("data-")?t:"data-"+t]=e[t]);var n,a="light",r="dark";for(n in window.GiscusThemeLight=a,window.GiscusThemeDark=r,i["data-theme"]="dark"===document.documentElement.getAttribute("data-user-color-scheme")?r:a,i){var s=i[n];null!=s&&""!==s||delete i[n]}var o,c=document.createElement("script");for(o in c.setAttribute("src","https://giscus.app/client.js"),c.setAttribute("crossorigin","anonymous"),i)c.setAttribute(o,i[o]);r=document.getElementsByTagName("script"),a=0<r.length?r[r.length-1]:document.head||document.documentElement;a.parentNode.insertBefore(c,a.nextSibling)})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class=sidebar style=margin-left:-1rem><div id=toc><p class=toc-header><i class="iconfont icon-list"></i> <span>目录</span></p><div class=toc-body id=toc-body></div></div></aside></div></div></div><a id=scroll-top-button aria-label=TOP href=# role=button><i class="iconfont icon-arrowup" aria-hidden=true></i></a><div class="modal fade" id=modalSearch tabindex=-1 role=dialog aria-labelledby=ModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-lg" role=document><div class=modal-content><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type=button id=local-search-close class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type=text id=local-search-input class="form-control validate"> <label data-error=x data-success=v for=local-search-input>关键词</label></div><div class=list-group id=local-search-result></div></div></div></div></div></main><footer><div class=footer-inner><div class=footer-content><a href=https://hexo.io target=_blank rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i></div><div class=statistics><span id=busuanzi_container_site_pv style=display:none>总访问量 <span id=busuanzi_value_site_pv></span> 次 </span><span id=busuanzi_container_site_uv style=display:none>总访客数 <span id=busuanzi_value_site_uv></span> 人</span></div></div></footer><script src=https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js></script><link rel=stylesheet href=https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src=https://lib.baomitu.com/jquery/3.6.0/jquery.min.js></script><script src=https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js></script><script src=/js/events.js></script><script src=/js/plugins.js></script><script src=https://lib.baomitu.com/typed.js/2.0.12/typed.min.js></script><script>(t=>{var e=Fluid.plugins.typing;(t=t.getElementById("subtitle"))&&e&&e(t.getAttribute("data-typed-text"))})((window,document))</script><script src=/js/img-lazyload.js></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer=defer src=/js/leancloud.js></script><script src=/js/local-search.js></script><script defer=defer src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=/js/boot.js></script><noscript><div class=noscript-warning>博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>